<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DataTable</title>
</head>
<link rel="stylesheet" type="text/css" href="DataTable/css/dataTables.bootstrap.css" />
<link rel="stylesheet" type="text/css" href="DataTable/css/bootstrap.min.css"/>
<link href="../css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="DataTable/js/jquery.min.js"></script>

<body onload="initDataTable()">
<!--位置div-->
<div class="place">
    <span>位置：</span>
    <ul class="placeul">
        <li><a href="#">首页</a></li>
        <li><a href="#">图片列表</a></li>
    </ul>
</div>
<!--toolBar-->
<div class="rightinfo">
    <div class="tools">

        <ul class="toolbar">
            <li onclick="Add()"><img src="../images/t01.png" />添加</li>
            <li class="click"><img src="../images/t02.png" />修改</li>
            <li><img src="../images/t03.png" />删除</li>
            <li><img src="../images/t04.png" />统计</li>
            <li onclick="Export()"><img src="img/export.png" />导出</li>
            <li onclick="Print()"><img src="img/print.png" />打印</li>
            <li onclick="Sort()"><img src="img/print.png" />排序</li>
        </ul>


        <ul class="toolbar1">
            <li><img src="../images/t05.png" />设置</li>
        </ul>
    </div>
    <div>
        <table class="table table-striped table-bordered table-hover datatable" id="record_list">
            <thead>
            <tr>
                <th class="table-checkbox"><input type="checkbox" class="group-checkable" data-set="#record_list .checkboxes" /></th>
                <th>用户名</th>
                <th>mail</th>
                <th>用户权限级别</th>
                <th>姓名</th>
                <th>性别</th>
                <th>注册日期</th>
                <th>最后登录日期</th>
                <th>用户信息最后修改日期</th>
                <th>是否员工(1 是 | 0 不是)</th>
            </tr>
            </thead>
            </table>
    </div>

    <!--提示信息,class中定义其为不可见的-->
    <!--add tip-->
    <div class="tip" id="add_tip">
        <div class="tiptop"><span>提示信息</span><a></a></div>

        <label style="position: relative; width: 20%; float: left">用户名</label>
        <label>
            <input type="text" style="position:relative; width: 80%; float: left" value="">
        </label>
        <!--tip中的button-->
        <div class="tipbtn">
            <input name="" type="button"  class="sure" value="确定" />
            <input name="" type="button"  class="cancel" value="取消" />
        </div>

    </div>
<!--    <script src="js/jigsaw.js" type=""></script>-->

<!--    <div class="login-form" style="position: relative; width: 50%; height: 50%; display: none">-->
<!--        <div class="sign-in-htm">-->
<!--            <div class="group">-->
<!--                <label  class="label">用户名/邮箱</label>-->
<!--                <label for="account"></label><input id="account" name="username" value="admin" type="text" class="input">-->
<!--            </div>-->
<!--            <div class="group">-->
<!--                <label class="label">密码</label>-->
<!--                <input id="password" type="password" class="input" data-type="password">-->
<!--            </div>-->
<!--            <div class="hr"></div>-->
<!--        </div>-->
<!--    </div>-->


    <!--导出tip-->
    <div class="tip" id="tip">
        <div class="tiptop"><span>提示信息</span><a></a></div>

        <div class="tipinfo">
            <span><img src="img/tip.png" /></span>
            <div class="tipright">
                <p id="flag">是否确认对信息的修改 ？</p>
                <cite><a href="" id="txtDownLoadHref">[点击下载txt]</a></cite>
                <cite><a href="" id="excelDownLoadHref">[点击下载excel]</a></cite>
            </div>
        </div>

        <!--tip中的button-->
        <div class="tipbtn">
            <input name="" type="button"  class="sure" value="确定" />
            <input name="" type="button"  class="cancel" value="取消" />
        </div>

    </div>

</div>
</body>
<script type="text/javascript" src="DataTable/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="DataTable/js/jquery.uniform.min.js"></script>
<script type="text/javascript" src="DataTable/js/jquery.dataTables.min.js"></script>

<script>
    // 保存当前的dataTable信息
    let type=this.location.search;
    let data=type.split("sort=");
    let sort=data[1];
    // 获取上页传入的信息
    sort=decodeURI(sort);
    function Add(){
        let addTip=document.getElementById("add_tip");
        addTip.style.display="block";

    }

    function Export() {
        alert("开始导出!");
        let tip=document.getElementById("tip");
        // 建议JAVA后端查询得到的JSON直接导出，而不是前端向后端传递JSON再导出
        let message = {};
        let url = "../ServletAction";
        message.Action = "exportFile";
        // 表名
        message.tableName='accountInfo';
        $.post(url, message, function (json) {
            if (json.ok === 200) {
                // 显示tip
                tip.style.display="block";
                document.getElementById("flag").innerText="导出成功!";
                $("#txtDownLoadHref").attr("href",json.txtDownloadPath);
                $("#excelDownLoadHref").attr("href",json.excelDownloadPath);
            } else {
                tip.style.display="block";
                document.getElementById("flag").innerText="导出失败!";
            }
        });
    }
    function Print(){
        alert("即将前往Print");
       window.parent.location.href="print.html?";
    }
    function Sort(){
        alert("排序")
        sort="down";
        init();
        window.location.href="DataTable.html?sort="+sort;
    }

    function initDataTable(){
        // 全局设置监听
        $(".sure").click(function (){
            $(".tip").fadeOut(100);
        });
        // 2.弹窗的取消
        $(".cancel").click(function (){
            $(".tip").fadeOut(100);
        });
        $(".tiptop a").click(function (){
            $(".tip").fadeOut(100);
        });

        // 初始化DataTable！
        init();
    }

    function init(){
        alert(sort);
        $('.datatable').dataTable({
            "paging": true,
            "searching": false,
            "retrieve":true,
            // "destroy":true,
            "oLanguage": {
                "aria": {
                    "sortAscending": ": activate to sort column ascending",
                    "sortDescending": ": activate to sort column descending"
                },
                "sProcessing": "处理中...",
                "sLengthMenu": "_MENU_ 记录/页",
                "sZeroRecords": "没有匹配的记录",
                "sInfo": "显示第 _START_ 至 _END_ 项记录，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项记录，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项记录过滤)",
                "sInfoPostFix": "",
                "sSearch": "过滤:",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                }
            },
            "aoColumns": [{
                "mRender": function (data, type, full) {
                    sReturn = '<input type="checkbox" class="checkboxes" value="' + data + '"/>';
                    return sReturn;
                }, "orderable": false
            }, {
                "mRender": function (data, type, full) {
                    sReturn = "<div>"+full.account+"</div>";
                    return sReturn;
                }, "orderable": false
            }, {
                "mRender": function (data, type, full) {
                    sReturn = "<div>"+full.mail+"</div>";
                    return sReturn;
                }, "orderable": false
            }, {
                "mRender": function (data, type, full) {
                    sReturn = "<div>"+full.userLevel+"</div>";
                    return sReturn;
                }, "orderable": false
            }, {
                "mRender": function (data, type, full) {
                    sReturn ="<div>"+full.userName+"</div>";
                    return sReturn;
                }, "orderable": false
            },{
                "mRender": function (data, type, full) {
                    sReturn = "<div>"+full.userGender+"</div>";
                    return sReturn;
                }, "orderable": false
            },{
                "mRender": function (data, type, full) {
                    sReturn = "<div>"+full.signUpDate+"</div>";
                    return sReturn;
                }, "orderable": false
            },{
                "mRender": function (data, type, full) {
                    sReturn = "<div>"+full.lastLoginDate+"</div>";
                    return sReturn;
                }, "orderable": false
            },{
                "mRender": function (data, type, full) {
                    sReturn = "<div>"+full.lastModifyDate+"</div>";
                    return sReturn;
                }, "orderable": false
            },{
                "mRender": function (data, type, full) {
                    let temp;
                    if(full.isWorker===1){
                        temp="是";
                    }else{
                        temp="否";
                    }
                    sReturn = "<div>"+temp+"</div>";
                    return sReturn;
                }, "orderable": false
            }],
            "aLengthMenu": [[5, 10, 15, 20, 25, 40, 50, -1], [5, 10, 15, 20, 25, 40, 50, "所有记录"]],
            "fnDrawCallback": function () {
                $(".checkboxes").uniform();
                $(".group-checkable").uniform();
            },
            "sAjaxSource": "../ServletAction?Action=getUserRecord&sort="+sort
        });
        $('.datatable').find('.group-checkable').change(function () {
            var set = jQuery(this).attr("data-set");
            var checked = jQuery(this).is(":checked");
            jQuery(set).each(function () {
                if (checked) {
                    $(this).attr("checked", true);
                    $(this).parents('tr').addClass("active");
                } else {
                    $(this).attr("checked", false);
                    $(this).parents('tr').removeClass("active");
                }
            });
            jQuery.uniform.update(set);
        });
        $('.datatable').on('change', 'tbody tr .checkboxes', function () {
            $(this).parents('tr').toggleClass("active");
        });
    };
</script>
</html>
